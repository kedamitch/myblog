var util = require('util');
var rp = require('fatfei.provider.loader');
var redis = require('redis');
var redisFactory = require('fatfei.factory.redisfactory');
// var settings = rp.providerSettings.dao;
var userPrefix = "blogUser:";

var userDao = {

    addUser: function(username, userInfo, cb) {
        console.info(rp.providerSettings.dao.redis);
        var key = userPrefix + username;
        redisFactory(rp.providerSettings.dao.redis, function(err, client) {
            if (err) {
                cb(err);
                return;
            }
            client.set(key, JSON.stringify(userInfo), function(err) {
                cb(err);
            });
        });
    },

    getUserInfo: function(username, cb) {
        var key = userPrefix + username;
        redisFactory(rp.providerSettings.dao.redis, function(err, client) {
            if (err) {
                cb(err);
                return;
            }
            client.get(key, function(err, userInfo) {
                if (err) {
                    cb(err);
                } else {
                    userInfo = JSON.parse(userInfo);
                    cb(0, userInfo);
                }
            });
        });
    }

};

module.exports = userDao;