module.exports = function(serviceFn) {
    return function(serveCtx) {

        serveCtx.getRequestArgs = function(cb) {
            var header = serveCtx.header;
            var body = serveCtx.body;
            var hash = {};
            for (var key in header) {
                if (header.hasOwnProperty(key)) {
                    hash[key] = header[key];
                }
            }
            for (key in body) {
                if (body.hasOwnProperty(key)) {
                    hash[key] = body[key];
                }
            }
            cb(0, hash);
        };

        serveCtx.getheader = function() {
            return serveCtx.header;
        };

        serveCtx.getBody = function() {
            return serveCtx.body;
        };

        serveCtx.ishttp = false;

        serveCtx.responseData = function(header, body, to) {
            if (serveCtx.header.uuid) {
                header.uuid = serveCtx.header.uuid;
            }
            var data = {
                "header": header,
                "body": body
            };
            if (serveCtx.ws) {
                serveCtx.ws.send(JSON.stringify(data));
            }
        };

        serveCtx.simpleResponse = function(rspType, errCode, msg) {
            var header = {},
                body = {};
            header.type = rspType;
            header.time = (new Date()).Format("yyyy-MM-dd hh:mm:ss");
            if (serveCtx.header.uuid) {
                header.uuid = serveCtx.header.uuid;
            }
            body.err = errCode;
            body.data = msg;
            var data = {
                "header": header,
                "body": body
            };

            if (serveCtx.ws && serveCtx.ws.send) {
                serveCtx.ws.send(JSON.stringify(data));
            }
        };

        try {
            serviceFn(serveCtx);
        } catch (e) {
            console.error(e.stack);
        }
    };
};